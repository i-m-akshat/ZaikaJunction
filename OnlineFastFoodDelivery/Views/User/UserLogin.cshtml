@model Models.User

@{
    ViewData["Title"] = "UserLogin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@* 


<div class="itemContainer">
    <div class="container mt-5">
        <div class="row justify-content-center align-items-center">
            <div class="card col-12 col-xl-10">
                <div class="card-body">
                    <div class="row justify-content-center align-items-center g-2">
                        <div class="col-md-8" style="border-style:none">
                            <img src="../Naomi-Sherman-Advanced-Graduate4.jpg" alt="Image" class="d-none d-md-flex img-fluid" style="border-radius:2rem" />
                        </div>

                        <div class="card col-md-4" style="border-style:none;background-color:transparent">
                            <div class="card-body">
                                <h1 class="Heading text-black">Login</h1>
                                <form asp-action="UserLogin" method="post">
                                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                                    <div class="form-floating  my-3">
                                        <input asp-for="UserName" class="form-control form-control-sm" placeholder="Please Enter your Username" />
                                        <label asp-for="UserName"></label>
                                        <span asp-validation-for="UserName" class="text-danger"></span>
                                    </div>

                                    <div class="form-floating my-3">
                                        <input type="password" asp-for="Password" placeholder="Please Enter the password" class="form-control form-control-sm" />
                                        <label asp-for="Password"></label>
                                        <span asp-validation-for="Password"  class="text-danger"></span>
                                    </div>

                                    <div class="form-group my-3 mx-auto">
                                        <input type="submit" value="Login" class="btn btn-outline-dark float-end" style="border-radius:2rem" />
                                        new user? Please <span class="badge bg-primary text-bg-light"><a asp-action="UserSignUp" value="SignUp" class="float-start text-white" style="border-radius:2rem;text-decoration:none;">Sign Up</a></span>
                                    </div>
                                    <div class="form-group my-3 mx-auto">
                                        <a class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" role="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop_Forgot">
                                            Forgot Password?
                                        </a>
                                    </div>
                                    <!-- Modal -->
                                    <div class="modal fade" id="staticBackdrop_Forgot" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdrop_ForgotLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5 row-header text-black-50" id="staticBackdrop_ForgotLabel">Forgot Password</h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                  <div class="form-floating my-3">
                                                      
                                                        <input type="text" id="txtUsername" placeholder="Please Enter your Username" class="form-control-sm form-control" title="Username" />
                                                        <label class="form-label">Username:</label>
                                                        <span asp-validation-for="UserName" class="text-danger"></span>
                                                  </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                                                    <button type="button" id="btnSubmit" class="btn btn-success">Submit</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal fade" id="staticBackdrop_OTP" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdrop_ForgotLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5 row-header text-black-50" id="staticBackdrop_ForgotLabel">OTP</h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="form-floating my-3">
                                                        <input type="number" id="txtOTP" placeholder="Please Enter the OTP" class="form-control-sm form-control" title="OTP" />
                                                        <label class="form-label">OTP:</label>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                                                    <button type="button" id="btnVerify" class="btn btn-success">Verify</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal fade" id="staticBackdrop_Reset" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdrop_ForgotLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5 row-header text-black-50" id="staticBackdrop_ForgotLabel">Reset Password</h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="form-floating my-3">
                                                        <input type="password" id="txtResetPassword" placeholder="Please Enter the new Password" class="form-control-sm form-control" title="Password" />
                                                        <label class="form-label">Password:</label>
                                                        <span asp-validation-for="Password" class="text-danger"></span>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                                                    <button type="button" id="btnReset" class="btn btn-success">Reset</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal fade" id="staticBackdrop_Loader" style="border-radius:20%" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdrop_ForgotLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered modal-sm">
                                            <div class="modal-content">
                                                <img src="~/images/What Emoji Best Describes You_.gif" />
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
       
  
</div> *@
<div class="d-flex justify-content-center align-items-start pt-2 my-4 pb-1 px-3">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden" style="max-width: 900px; width: 100%;">
        <div class="row g-0">
            <!-- Image Section -->
            <div class="col-md-6 d-flex justify-content-center align-items-center"
                 style="background-image: url('/img/Login.jpeg'); background-size: cover; background-position: center; min-height: 250px; border-radius: 1.5rem 0 0 1.5rem;">
                @* <h3 class="text-dark fw-bold text-shadow-custom text-center px-3">Your Culinary Journey Starts Here!</h3> *@
            </div>

            <!-- Login Form Section -->
            <div class="col-md-6 p-5 bg-white">
                <h2 class="text-center text-warning fw-bold mb-4" style="font-size: 2.25rem;">Login</h2>
                <form action="UserLogin" method="post">
                    <div class="form-floating my-3">
                        <input type="text" id="UserName" name="UserName" class="form-control form-control-sm" placeholder="Username" required />
                        <label for="UserName">Username</label>
                    </div>

                    <div class="form-floating my-3">
                        <input type="password" id="Password" name="Password" class="form-control form-control-sm" placeholder="Password" required />
                        <label for="Password">Password</label>
                    </div>

                    <div class="d-flex justify-content-end my-3">
                        <button type="submit" class="btn btn-warning py-2 px-4 fw-bold rounded-pill shadow">Login</button>
                    </div>

                    <div class="text-center mt-3 small text-secondary">
                        New user? Please
                        <span class="badge bg-warning text-dark">
                            <a href="#" class="text-dark text-decoration-none fw-semibold">Sign Up</a>
                        </span>
                    </div>

                    <div class="text-center mt-3 small">
                        <a class="link-offset-2 link-offset-3-hover link-underline-opacity-0 link-underline-opacity-75-hover text-warning"
                           role="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop_Forgot">
                            Forgot Password?
                        </a>
                    </div>
                </form>

                <!-- Modals (Forgot Password, OTP, Reset Password, Loader) -->
                <!-- Forgot Password Modal -->
                <div class="modal fade" id="staticBackdrop_Forgot" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdrop_ForgotLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content bg-light rounded-4 shadow-lg text-dark">
                            <!-- Added rounded-4 and shadow-lg -->
                            <div class="modal-header bg-light border-bottom-0 rounded-top-4">
                                <!-- Light header, no bottom border -->
                                <h1 class="modal-title fs-5 text-warning fw-bold" id="staticBackdrop_ForgotLabel">Forgot Password</h1> <!-- Yellow title -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-4">
                                <div class="form-floating my-3">
                                    <input type="text" id="txtUsername" class="form-control form-control-sm rounded-3" placeholder="Enter your Username or Email" />
                                    <label for="txtUsername">Username or Email:</label>
                                </div>
                            </div>
                            <div class="modal-footer border-top-0 d-flex justify-content-end">
                                <!-- No top border, right align buttons -->
                                <button type="button" class="btn btn-danger rounded-pill px-4" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" id="btnSubmit" class="btn btn-success rounded-pill px-4">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- OTP Modal -->
                <div class="modal fade" id="staticBackdrop_OTP" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdrop_OTPLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content bg-light rounded-4 shadow-lg text-dark">
                            <!-- Added rounded-4 and shadow-lg -->
                            <div class="modal-header bg-light border-bottom-0 rounded-top-4">
                                <!-- Light header, no bottom border -->
                                <h1 class="modal-title fs-5 text-warning fw-bold" id="staticBackdrop_OTPLabel">Enter OTP</h1> <!-- Yellow title -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-4">
                                <div class="form-floating my-3">
                                    <input type="number" id="txtOTP" class="form-control form-control-sm rounded-3" placeholder="Enter the 6-digit OTP" />
                                    <label for="txtOTP">OTP:</label>
                                </div>
                            </div>
                            <div class="modal-footer border-top-0 d-flex justify-content-end">
                                <!-- No top border, right align buttons -->
                                <button type="button" class="btn btn-danger rounded-pill px-4" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" id="btnVerify" class="btn btn-success rounded-pill px-4">Verify</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reset Password Modal -->
                <div class="modal fade" id="staticBackdrop_Reset" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdrop_ResetLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content bg-light rounded-4 shadow-lg text-dark">
                            <!-- Added rounded-4 and shadow-lg -->
                            <div class="modal-header bg-light border-bottom-0 rounded-top-4">
                                <!-- Light header, no bottom border -->
                                <h1 class="modal-title fs-5 text-warning fw-bold" id="staticBackdrop_ResetLabel">Reset Password</h1> <!-- Yellow title -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-4">
                                <div class="form-floating my-3">
                                    <input type="password" id="txtResetPassword" class="form-control form-control-sm rounded-3" placeholder="Enter your new Password" />
                                    <label for="txtResetPassword">New Password:</label>
                                </div>
                                <div class="form-floating my-3">
                                    <input type="password" id="txtConfirmResetPassword" class="form-control form-control-sm rounded-3" placeholder="Confirm your new Password" />
                                    <label for="txtConfirmResetPassword">Confirm Password:</label>
                                </div>
                            </div>
                            <div class="modal-footer border-top-0 d-flex justify-content-end">
                                <!-- No top border, right align buttons -->
                                <button type="button" class="btn btn-danger rounded-pill px-4" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" id="btnReset" class="btn btn-success rounded-pill px-4">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loader Modal -->
                <div class="modal fade" id="staticBackdrop_Loader" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content bg-light rounded-4 shadow-lg text-dark p-4 text-center border-0">

                            <!-- Enlarged GIF loader with better balance -->
                            <div class="d-flex justify-content-center mb-4">
                                <div class="bg-warning bg-opacity-10 p-3 rounded-4 shadow-sm">
                                    <img src="~/img/Loader.gif" alt="Loading..." class="img-fluid" style="max-width: 100%; height: auto; width: 280px;" />
                                </div>
                            </div>

                            <!-- Heading and description -->
                            <h5 class="fw-bold text-warning mb-2">Please wait...</h5>
                            <p class="text-secondary fw-medium" style="font-size: 1rem;">We're preparing your experience 🍽️</p>

                        </div>
                    </div>
                </div>



            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('#btnSubmit').click(() => {
            UserName = $("#txtUsername").val();
            console.log(typeof(UserName));
            $.ajax({
                url: 'FindUserByUsername?UserName=',
                method:'POST',
                contentType: "application/json",
                data: JSON.stringify(UserName),
                success: function (data) {
                    // Handle the success response
                    console.log(data);
                    if(data!=null){
    
                        $('#staticBackdrop_Forgot').modal('hide');
                        $('#staticBackdrop_Loader').modal('show');
                        $.ajax({
                            url: '@Url.Content("~/Email/SendOTP?EMailID=")',
                            method: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify(data.email),
                            success: function (data) {
                                $('#staticBackdrop_Loader').modal('hide');
                                swal("OTP sent!", "Please Reset Your Password using the OTP", "success");
                                $('#staticBackdrop_OTP').modal('show');
                            },
                            error: function (error) {
                                swal("Error !", "Something went wrong", "error");
                            }
                        })
                    }else{
                        swal("Failed !", "User doesn't exist with this username", "error");
                    }
                    
                },
                error: function (error) {
                    // Handle the error response
                    console.error("Error in POST request: ", error);
                }
            })
        }
        )
        $('#btnVerify').click(()=>{
            $('#staticBackdrop_OTP').modal('hide');
            // $('#staticBackdrop_Loader').modal('show');
            var txtOTP = $("#txtOTP").val();
            console.log(txtOTP);
            $.ajax({
                url: 'VerifyOTP?OTP=',
                method:'POST',
                contentType:'application/json',
                data:JSON.stringify(txtOTP),
                success: function (data) {
                    console.log(data);
                    // $('#staticBackdrop_Loader').modal('hide');
                    $('#staticBackdrop_Reset').modal('show');
                },
                error:function(error){
                    console.error("ERROR in POST Request", error);
                }
            })
        })
        $('#btnReset').click(()=>{
            var ResettedPassword = $('#txtResetPassword').val();
            $('#staticBackdrop_Reset').modal('hide');
            // $('#staticBackdrop_Loader').modal('show');
            $.ajax({
                url: 'ResetPassword?Password=',
                method:'POST',
                contentType:'application/json',
                data: JSON.stringify(ResettedPassword),
                success: function (data) {
                    if(data==true){
                        // $('#staticBackdrop_Loader').modal('hide');
                        swal("Password Reset Successful !", "Please Login ", "success");
                        

                    }else{
                        swal("Error !", "Something went wrong", "error");
                    }
                },
                error:function(error){
                    swal("Error !", "Something went wrong", "error");
                }
            })
        })
       
    });
</script>
